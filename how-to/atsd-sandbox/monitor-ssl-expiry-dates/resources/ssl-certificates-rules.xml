<?xml version="1.0" encoding="UTF-8"?><rules>
<rule>
<name>ssl-certificates-changing</name>
<metric>http.ssl_certificate_not_after_date</metric>
<tags>url</tags>
<tagsGroupingStrategy>DEFINED_TAGS</tagsGroupingStrategy>
<expression><![CDATA[isNew OR !current.equals(previous)]]></expression>
<window>length(2)</window>
<filter>tags.name = 'ssl-cert-check' AND NOT (entity IN collection('domains-blacklist'))</filter>
<severity>WARNING</severity>
<alertOpenMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertOpenMessage>
<alertMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertMessage>
<alertMessageAsOpen>true</alertMessageAsOpen>
<alertCancellationMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertCancellationMessage>
<alertCancellationMessageAsOpen>true</alertCancellationMessageAsOpen>
<alertStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</alertStrategy>
<userExpressions>
<expression><![CDATA[count() == 2 ? first() : first(1) AS previous]]></expression>
<expression><![CDATA[count() == 2 ? first(1): value AS current]]></expression>
<expression><![CDATA[lookup('http-status-meanings', formatNumber(value('http.status'), '#')) AS httpStatus]]></expression>
<expression><![CDATA[count() == 1 AS isNew]]></expression>
<expression><![CDATA[date_format(milliseconds(formatNumber(current, '#'), 'yyyyMMdd'), 'yyyy-MM-dd') AS currentDate]]></expression>
<expression><![CDATA[(NOT isNew)? date_format(milliseconds(formatNumber(previous, '#'), 'yyyyMMdd'), 'yyyy-MM-dd'): 'NaN' AS previousDate]]></expression>
<expression><![CDATA["The certificate expiry date is set to " +  (currentDate) + " at the first time." AS newMessage]]></expression>
<expression><![CDATA["The certificate is valid to " +  (currentDate)  + " was " + (previousDate) + "." AS changeMessage]]></expression>
<expression><![CDATA[isNew?newMessage:changeMessage AS certMessage]]></expression>
</userExpressions>
<lastUpdated>1524848526109</lastUpdated>
<enabled>true</enabled>
<disableEntityGrouping>true</disableEntityGrouping>
<leavingEvents>true</leavingEvents>
<loadHistory>true</loadHistory>
<scriptAsOpen>true</scriptAsOpen>
<alertCancellationScriptAsOpen>true</alertCancellationScriptAsOpen>
<logOutput>false</logOutput>
<owner>Axibase</owner>
<description><![CDATA[Notify when SSL certificate is expired for certain URL.]]></description>
<actionStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</actionStrategy>
<timeFilter>
<intervalCount>15</intervalCount>
<intervalUnit>SECOND</intervalUnit>
</timeFilter>
<discardPreviousValues>true</discardPreviousValues>
<webNotification>
<disabled>false</disabled>
<rule-name>ssl-certificates-changing</rule-name>
<repeat-interval>
<type>ALL</type>
<intervalCount>24</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</repeat-interval>
<name>Web Service Notification id=646</name>
<use-in-threshold-only>false</use-in-threshold-only>
<first-details>false</first-details>
<repeat-details>false</repeat-details>
<cancel-details>true</cancel-details>
<first-screenshot>false</first-screenshot>
<repeat-screenshot>false</repeat-screenshot>
<cancel-screenshot>true</cancel-screenshot>
<repeat-as-open>true</repeat-as-open>
<cancel-as-open>false</cancel-as-open>
<webNotificationConfigName>Slack</webNotificationConfigName>
<firstWebConfigParameters>
<key>text</key>
<value>${status}: SSL certificate for the URL ${tags.url} was changed. ${certMessage} Http connection state: ${httpStatus}.</value>
</firstWebConfigParameters>
<repeatWebConfigParameters>
<key>text</key>
<value>${status}: SSL certificate for the URL ${tags.url} was changed. ${certMessage} Http connection state: ${httpStatus}.</value>
</repeatWebConfigParameters>
<cancelWebConfigParameters>
<key>text</key>
<value>[${status}] ${rule} for ${entity.displayName} ${tags}. Duration: ${alert_duration_interval}. ${ruleLink}</value>
</cancelWebConfigParameters>
<first-enabled>true</first-enabled>
<repeat-enabled>true</repeat-enabled>
<cancel-enabled>false</cancel-enabled>
</webNotification>
<ruleTable/>
<derivedCommand>series e:${entity} m:metric_123=${100 - value} ${commandTags}</derivedCommand>
<derivedCommandEnabled>false</derivedCommandEnabled>
<derivedCommandStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</derivedCommandStrategy>
<alertOpenMessageEnabled>false</alertOpenMessageEnabled>
<alertMessageEnabled>false</alertMessageEnabled>
<alertCancellationMessageEnabled>false</alertCancellationMessageEnabled>
<alertOpenScriptEnabled>false</alertOpenScriptEnabled>
<scriptEnabled>false</scriptEnabled>
<alertCancellationScriptEnabled>false</alertCancellationScriptEnabled>
</rule>
<rule>
<name>ssl-certificates-expiration</name>
<metric>http.ssl_certificate_expiration_days</metric>
<tags>url</tags>
<tagsGroupingStrategy>DEFINED_TAGS</tagsGroupingStrategy>
<expression><![CDATA[isPresent AND value < expiration_limit]]></expression>
<window>length(1)</window>
<filter>tags.name = 'ssl-cert-check' AND NOT (entity IN collection('domains-blacklist'))</filter>
<severity>WARNING</severity>
<alertOpenMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertOpenMessage>
<alertMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertMessage>
<alertMessageAsOpen>true</alertMessageAsOpen>
<alertCancellationMessage><![CDATA[${received_datetime}	${status}	${severity}	${rule}	${metric}	${entity.displayName}	${tags}	${value}]]></alertCancellationMessage>
<alertCancellationMessageAsOpen>true</alertCancellationMessageAsOpen>
<alertStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</alertStrategy>
<userExpressions>
<expression><![CDATA[30 AS expiration_limit]]></expression>
<expression><![CDATA[NOT Double.isNaN(value) AS isPresent]]></expression>
</userExpressions>
<lastUpdated>1524849125065</lastUpdated>
<enabled>true</enabled>
<disableEntityGrouping>true</disableEntityGrouping>
<leavingEvents>true</leavingEvents>
<loadHistory>false</loadHistory>
<scriptAsOpen>true</scriptAsOpen>
<alertCancellationScriptAsOpen>true</alertCancellationScriptAsOpen>
<logOutput>false</logOutput>
<owner>Axibase</owner>
<description><![CDATA[Notify when SSL certificate is expired for certain URL.]]></description>
<actionStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</actionStrategy>
<timeFilter>
<intervalCount>1</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</timeFilter>
<discardPreviousValues>true</discardPreviousValues>
<webNotification>
<disabled>false</disabled>
<rule-name>ssl-certificates-expiration</rule-name>
<repeat-interval>
<type>ALL</type>
<intervalCount>24</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</repeat-interval>
<name>Web Service Notification id=646</name>
<use-in-threshold-only>false</use-in-threshold-only>
<first-details>false</first-details>
<repeat-details>false</repeat-details>
<cancel-details>true</cancel-details>
<first-screenshot>false</first-screenshot>
<repeat-screenshot>false</repeat-screenshot>
<cancel-screenshot>true</cancel-screenshot>
<repeat-as-open>true</repeat-as-open>
<cancel-as-open>false</cancel-as-open>
<webNotificationConfigName>Slack</webNotificationConfigName>
<firstWebConfigParameters>
<key>text</key>
<value>${status}: SSL certificate for the URL ${tags.url} expired in less than ${expiration_limit} days. Remaining ${value} days.</value>
</firstWebConfigParameters>
<repeatWebConfigParameters>
<key>text</key>
<value>${status}: SSL certificate for the URL ${tags.url} expired in less than ${expiration_limit} days. Remaining ${value} days.</value>
</repeatWebConfigParameters>
<cancelWebConfigParameters>
<key>text</key>
<value>[${status}] ${rule} for ${entity.displayName} ${tags}. Duration: ${alert_duration_interval}. ${ruleLink}</value>
</cancelWebConfigParameters>
<first-enabled>true</first-enabled>
<repeat-enabled>true</repeat-enabled>
<cancel-enabled>false</cancel-enabled>
</webNotification>
<ruleTable/>
<derivedCommand>series e:${entity} m:metric_123=${100 - value} ${commandTags}</derivedCommand>
<derivedCommandEnabled>false</derivedCommandEnabled>
<derivedCommandStrategy>
<type>ALL</type>
<intervalCount>5</intervalCount>
<intervalUnit>MINUTE</intervalUnit>
</derivedCommandStrategy>
<alertOpenMessageEnabled>false</alertOpenMessageEnabled>
<alertMessageEnabled>false</alertMessageEnabled>
<alertCancellationMessageEnabled>false</alertCancellationMessageEnabled>
<alertOpenScriptEnabled>false</alertOpenScriptEnabled>
<scriptEnabled>false</scriptEnabled>
<alertCancellationScriptEnabled>false</alertCancellationScriptEnabled>
</rule>
</rules>
